{% extends 'detour.html.twig' %}

{% block body %}
<form action="{{ url('actionEditRegistration') }}" method="post" id="form_editRegistration">

    <input type="hidden" value="{{ registration.registrationId|default('') }}"
           id="Registration_ID" name="Registration_ID">
    <input type="hidden" value="{{ transferredRegistration.registrationId|default('') }}" id="TransferredFrom"
           name="TransferredFrom">

    <div class="container bg-white">
    <div class="row">
        <div class="col-sm-12">
            <h2 id="reg_header">
                {% if registration is not null and registration.registrationId %}
                Edit {{ (group.groupId is defined) ? 'Group ' : '' }}Membership - {{ registration.event.year }} - {{ registration.number }}
                {% elseif transferredRegistration is not null and transferredRegistration.registrationId %}
                Transfer Membership from {{ transferredRegistration.firstname }} {{ transferredRegistration.lastname }}
                    &lt;{{ transferredRegistration.number }}&gt; - {{ transferredRegistration.event.year }}
                {% else %}
                New {{ group is not null and group.groupId ? 'Group ' : '' }}Membership - {{ event.year }} - New
                {% endif %}
            </h2>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3">
            {% if registration is not null %}
                <a href="/registration/view/{{ registration.registrationId|default('') }}"
                   class="btn btn-primary btn-sm">Back - View Registration</a>
            {% else %}
                <a href="{{ url('listRegistrations') }}"
                   class="btn btn-primary btn-sm">Back - List Registrations</a>
            {% endif %}
        </div>
    </div>
    <br>

    <div class="row">
        <div class="col-sm-3">
            <h3>Registration Type:</h3>
        </div>
        <div class="col-sm-3">
            <h3>Registration Status:</h3>
        </div>
        <div class="col-sm-3">
        </div>
        <div class="col-sm-3">
        </div>
    </div>
    <div class="row">
        <div class="col-sm-3">
            <select name="RegistrationType" id="RegistrationType">
                {% for type in registrationTypes %}
                {# @var type AppBundle\Entity\RegistrationType #}
                <option value="{{ type.name }}" {{ selectedType is not null and selectedType.registrationTypeId == type.registrationTypeId ? 'selected' : '' }}>
                    {{ type.name }}
                </option>
                {% endfor %}
            </select>
            <select name="RegGroup_ID" id="RegGroup_ID"
                    style="width: 150px; {{ selectedType is null or selectedType.name != 'Group' ? 'display:none;' : '' }}">
                <option value=""></option>
                {% for regGroup in groups %}
                    <option value="{{ regGroup.groupId }}" {{ (group is not null and group.groupId == regGroup.groupId) ? 'selected' : '' }}>
                        {{ regGroup.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-sm-3">
            <select name="RegistrationStatus">
                {% for status in registrationStatuses %}
                    <option value="{{ status.status }}" {{ registration is not null and registration.registrationStatus.registrationStatusId == status.registrationStatusId ? 'selected' : '' }}>
                        {{ status.status }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <h3>Membership Type</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-primary btn-sm {{ ('ADREGSTANDARD' in currentBadgeTypes or 'MINOR' in currentBadgeTypes) ? 'active' : ''}}">
                    <input type="radio" name="regtype" value="ADREGSTANDARD"
                        {{ ('ADREGSTANDARD' in currentBadgeTypes or 'MINOR' in currentBadgeTypes) ? 'checked' : ''}}>
                    Standard (Minors detected by Birthdate)<br>
                </label>
                <label class="btn btn-primary btn-sm {{ 'ADREGSPONSOR' in currentBadgeTypes ? 'active' : '' }}">
                    <input type="radio" name="regtype" value="ADREGSPONSOR"
                        {{ 'ADREGSPONSOR' in currentBadgeTypes ? 'checked' : '' }}>
                    Sponsor<br>
                </label>
                <label class="btn btn-primary btn-sm {{ 'ADREGCOMMSPONSOR' in currentBadgeTypes ? 'active' : '' }}">
                    <input type="radio" name="regtype" value="ADREGCOMMSPONSOR"
                        {{ 'ADREGCOMMSPONSOR' in currentBadgeTypes ? 'checked' : '' }}>
                    Community Sponsor<br>
                </label>
                <label class="btn btn-primary btn-sm {{ 'GUEST' in currentBadgeTypes ? 'active' : '' }}">
                    <input type="radio" name="regtype" value="GUEST"
                        {{ 'GUEST' in currentBadgeTypes ? 'checked' : '' }}>
                    Guest<br>
                </label>
                <label class="btn btn-primary btn-sm {{ 'VENDOR' in currentBadgeTypes ? 'active' : '' }}">
                    <input type="radio" name="regtype" value="VENDOR"
                        {{ 'VENDOR' in currentBadgeTypes ? 'checked' : '' }}>
                    Vendor<br>
                </label>
                <label class="btn btn-primary btn-sm {{ 'EXHIBITOR' in currentBadgeTypes ? 'active' : '' }}">
                    <input type="radio" name="regtype" value="EXHIBITOR"
                        {{ 'EXHIBITOR' in currentBadgeTypes ? 'checked' : '' }}>
                    Exhibitor<br>
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <h3>Membership Details</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4">
            <div class="md-form">
                <input type="text"
                       id="lastName"
                       name="lastName"
                       class="form-control validate"
                       value="{{ registration.lastName|default('') }}"
                       required>
                <label class="required" for="lastName">
                    Last Name
                    <i class="fa fa-asterisk red-text small" aria-hidden="true"></i>
                </label>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="md-form">
                <input type="text"
                       id="firstName"
                       name="firstName"
                       class="form-control validate"
                       value="{{ registration.firstName|default('') }}"
                       required>
                <label class="required" for="firstName">
                    Last Name
                    <i class="fa fa-asterisk red-text small" aria-hidden="true"></i>
                </label>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="md-form">
                <input type="text"
                       id="middleName"
                       name="middleName"
                       class="form-control validate"
                       value="{{ registration.middleName|default('') }}"
                       required>
                <label for="middleName">
                    Middle Name
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-7">
            <div class="md-form">
                <input type="text"
                       id="address1"
                       name="address1"
                       class="form-control validate"
                       value="{{ registration.address|default('') }}"
                       required>
                <label for="address1">
                    Postal Mailing Address
                </label>
            </div>
        </div>
        <div class="col-sm-5">
            <div class="md-form">
                <input type="text"
                       id="address2"
                       name="address2"
                       class="form-control validate"
                       value="{{ registration.address2|default('') }}"
                       required>
                <label for="address2">
                    Address Line 2
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-7">
            <div class="md-form">
                <input type="text"
                       id="city"
                       name="city"
                       class="form-control validate"
                       value="{{ registration.city|default('') }}"
                       required>
                <label for="city">
                    City
                </label>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="md-form">
                <input type="text"
                       id="state"
                       name="state"
                       class="form-control validate"
                       value="{{ registration.state|default('') }}"
                       required>
                <label for="state">
                    State
                </label>
            </div>
        </div>
        <div class="col-sm-2">
            <div class="md-form">
                <input type="text"
                       id="zip"
                       name="zip"
                       class="form-control validate"
                       value="{{ registration.zip|default('') }}"
                       required>
                <label for="zip">
                    Zip
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <div class="md-form">
                <input type="text"
                       id="phone"
                       name="phone"
                       class="form-control validate"
                       value="{{ registration.phone|default('') }}"
                       placeholder="(651) 555-1234">
                <label for="phone">
                    Phone
                </label>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="md-form">
                <input type="email"
                       id="email"
                       name="email"
                       class="form-control validate"
                       placeholder="john.doe@gmail.com"
                       value="{{ registration.email|default('') }}">
                <label class="w-100" for="email" data-error="Please enter a valid email"
                       data-success="">
                    Email
                </label>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col-sm-6">
                    <div class="md-form">
                        <input type="text"
                               id="BadgeName"
                               name="BadgeName"
                               class="form-control validate"
                               value="{{ registration.badgeName|default('') }}"
                               placeholder="Captain Tightpants"
                               required>
                        <label for="BadgeName">
                            Badge Name
                        </label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="md-form">
                        <input type="text"
                               id="birthdate"
                               name="birthdate"
                               class="form-control validate"
                               value="{{ registration is not null ? registration.birthday|date('m/d') : '' }}"
                               placeholder="03/26"
                               required>
                        <label for="birthdate">
                            Birthdate (mm/dd)
                        </label>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="md-form">
                        <input type="text"
                               id="birthyear"
                               name="birthyear"
                               class="form-control validate"
                               value="{{ registration is not null ? registration.birthday|date('Y') : '' }}"
                               placeholder="2004"
                               required>
                        <label for="birthyear">
                            Birthyear (YYYY)
                        </label>
                    </div>
                </div>
            </div>
            <br>
            <br>

            <div class="row">
                <div class="col-sm-6">
                    <p class="font-small text-muted" style="margin-bottom:0px;">Volunteer?</p>

                    <input type="checkbox"
                           id="volunteer"
                           name="volunteer"
                           class="switch-input"
                            {{ registration is not null and registration.contactVolunteer ? 'Checked' : '' }}
                    >
                    <label for="volunteer" class="switch-label">
                        <span class="toggle--on">Yes</span>
                        <span class="toggle--off">No</span>
                    </label>
                </div>
                <div class="col-sm-6">
                    <p class="font-small text-muted" style="margin-bottom:0px;">Newsletter?</p>

                    <input type="checkbox"
                           id="newsletter"
                           name="newsletter"
                           class="switch-input"
                            {{ registration is not null and registration.contactNewsletter ? 'Checked' : '' }}
                    >
                    <label for="newsletter" class="switch-label">
                        <span class="toggle--on">Yes</span>
                        <span class="toggle--off">No</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label for="comments">Comments</label>
                        <textarea class="form-control rounded-0" name="comments" id="comments" rows="6"></textarea>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-sm-8">
                </div>

                <div class="col-sm-4">
                    <button id="save_form" type="button" class="btn btn-warning btn-lg">Save</button>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>

    <div class="row" id="alert_div" style="display: none">
        <div class="col-sm-12">
            <div class="bs-callout bs-callout-info" id="alert_subdiv">
                <h4 id="alert_heading">Info</h4>

                <p id="alert_msg">Unknown Error.</p>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col-sm-5">
            <h3>T-Shirts</h3>
        </div>
        <div class="col-sm-4">
            <h3>Extras:</h3>
        </div>
        <div class="col-sm-3">
            <h3>Advanced Options:</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-5">
            <div class="row">
                <div class="col-sm-12">
                    <table class="table table-striped" id="table_registrations">
                        <thead>
                        <tr height="15px">
                            <th>Type</th>
                            <th>Size</th>
                            <th class="text-right">Remove</th>
                        </tr>
                        </thead>
                        <tbody id="tshirt">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-5">
                    <div class="form-group">
                        <select class="form-control" name="shirt_type" id="shirt_type">
                            <option value="" default="">Select T-Shirt...</option>
                            <option value="MensTee">Men's T-Shirt</option>
                            <option value="WomensTee">Women's T-Shirt</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <select class="form-control" name="shirt_size" id="shirt_size">
                            <option value="" default="">Select Size...</option>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XLT">XLT (Mens Only)</option>
                            <option value="2XL">2XL</option>
                            <option value="2XLT">2XLT (Mens Only)</option>
                            <option value="3XL">3XL (Mens Only)</option>
                            <option value="3XLT">3XLT (Mens Only)</option>
                            <option value="4XL">4XL (Mens Only)</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group">
                        <button id="add_shirt" type="button" class="btn btn-primary btn-sm">Add</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="row">
                <div class="col-sm-12">
                    <table class="table table-striped" id="table_extras">
                        <thead>
                        <tr height="15px">
                            <th>Type</th>
                            <th class="text-right">Remove</th>
                        </tr>
                        </thead>
                        <tbody id="extras">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-8">
                    <div class="form-group">
                        <select class="form-control" name="extra" id="extra">
                            <option value="" default="">Select Extra...</option>
                            {% for extra in extras %}
                                <option value="{{ extra.name }}">{{ extra.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <button id="add_extra" type="button" class="btn btn-primary btn-sm">Add Extra</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3">
        {% if registration is not null and registration.registrationId %}
            <a href="/registration/transfer/{{ registration.registrationId }}" class="btn btn-primary btn-sm">Transfer Registration</a>
            <br>
            <a href="/registration/rollover/{{ registration.registrationId }}" class="btn btn-primary btn-sm">Rollover Registration</a>
        {% endif %}
        {% if group is not null %}
            <br>
            <a href="/registration/group/add/{{ group.groupId }}" class="btn btn-primary btn-sm">Add another registration to
                {{ group.name }}</a>
        {% endif %}
        {% if registration is not null and registration.registrationId %}
            <br>
            <a href="/registration/edit/" class="btn btn-primary btn-sm">Add another registration</a>
        {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-sm-9">
        </div>
        <div class="col-sm-3">
            <h3>Staff:</h3>
            <div class="alert alert-danger" role="alert" id="staffdiv">
                <div id="staffmsg">This member is also listed on staff for this year.</div>
                <a href="javascript:void(0);" class="btn btn-primary btn-sm" id="staffmodify">Remove</a>
            </div>
        </div>
    </div>
</div>
</form>


    <script>
        var registration_id = {{ registration.registrationId|default('null') }};

        $(function ()
        {
            $(".datepicker").datepicker({
                changeMonth: true,
                dateFormat: 'mm/dd'
            });
        });

        $(document).ready(function ()
        {
            get_regshirtlist();
            get_regextralist();
        });

        function render_shirt(RegistrationShirt_ID, shirt_type, shirt_size)
        {
            $('#tshirt')
                .append($('<tr>')
                    .attr('id', 'tr_' + RegistrationShirt_ID)
                    .append($('<td>')
                        .text(shirt_type)
                        .append($('<input>')
                            .attr('type', 'hidden')
                            .attr('name', 'RegistrationShirt_ID[]')
                            .attr('value', RegistrationShirt_ID)
                        )
                    )
                    .append($('<td>')
                        .html(shirt_size)
                    )
                    .append($('<td>')
                        .append($('<span>')
                            .attr('class', 'close-btn')
                            .append($('<a>')
                                .attr('id', 'delete_' + RegistrationShirt_ID)
                                .attr('href', 'javascript:void(0);')
                                .html('X')
                            )
                        )
                    )
                );

            $('#delete_' + RegistrationShirt_ID).click(function ()
            {
                delete_shirt(RegistrationShirt_ID);
            });
        }

        $('#add_shirt').click(function ()
        {
            var shirt_type = $('#shirt_type').val();
            var shirt_size = $('#shirt_size').val();
            var reg_id = $('#Registration_ID').val();

            var RegistrationShirt_ID = 0;
            $.getJSON('/editregshirtlist/'+reg_id+'/add',
                {
                    'Registration_ID': reg_id,
                    'shirt_type': shirt_type,
                    'shirt_size': shirt_size
                },
                function (json)
                {
                    if (json['success'] && json['RegistrationShirt_ID']) {
                        RegistrationShirt_ID = json['RegistrationShirt_ID'];
                        render_shirt(RegistrationShirt_ID, shirt_type, shirt_size);
                    } else {
                        alert('Error adding shirt. '+ json['message'])
                    }
                }
            );
        });

        function delete_shirt(RegistrationShirt_ID)
        {
            var reg_id = $('#Registration_ID').val();
            $.getJSON('/editregshirtlist/'+reg_id+'/delete',
                {
                    'Registration_ID': reg_id,
                    'RegistrationShirt_ID': RegistrationShirt_ID
                },
                function (json)
                {
                    $('#tr_' + RegistrationShirt_ID).remove();
                }
            );
            get_regshirtlist();
        }

        function get_regshirtlist()
        {
            var reg_id = $('#Registration_ID').val();
            if (reg_id == '') {
                //alert('You must save the user before you can add t-shirts');
                return;
            }

            $.getJSON('/getregshirtlist/' + reg_id,
                {},
                function (json)
                {
                    $('#tshirt').empty();

                    var shirtcount = json.length;
                    for (var i = 0; i < shirtcount; i++) {
                        var RegistrationShirt_ID = json[i]['RegistrationShirt_ID'];
                        var shirt_type = json[i]['shirt_type'];
                        var shirt_size = json[i]['shirt_size'];
                        render_shirt(RegistrationShirt_ID, shirt_type, shirt_size);
                    }
                }
            );
        }

        function render_extras(extraId, extra_type)
        {
            $('#extras')
                .append($('<tr>')
                    .attr('id', 'tr_extra_' + extraId)
                    .append($('<td>')
                        .text(extra_type)
                        .append($('<input>')
                            .attr('type', 'hidden')
                            .attr('name', 'extraId[]')
                            .attr('value', extraId)
                        )
                    )
                    .append($('<td>')
                        .append($('<span>')
                            .attr('class', 'close-btn')
                            .append($('<a>')
                                .attr('id', 'delete_extra_' + extraId)
                                .attr('href', 'javascript:void(0);')
                                .html('X')
                            )
                        )
                    )
                );

            $('#delete_extra_' + extraId).click(function ()
            {
                delete_extra(extraId);
            });
        }

        $('#add_extra').click(function ()
        {
            var extra = $('#extra').val();
            var reg_id = $('#Registration_ID').val();

            var extraId = 0;
            $.getJSON('/registration/ajax/extra/'+reg_id+'/add',
                {
                    'Registration_ID': reg_id,
                    'extra': extra
                },
                function (json)
                {
                    if (json['success'] && json['extraId']) {
                        extraId = json['extraId'];
                        render_extras(extraId, extra);
                    } else {
                        alert('Error adding extra. '+ json['message'])
                    }
                }
            );
        });

        function delete_extra(extraId)
        {
            var reg_id = $('#Registration_ID').val();
            $.getJSON('/registration/ajax/extra/'+reg_id+'/delete',
                {
                    'Registration_ID': reg_id,
                    'extraId': extraId
                },
                function (json)
                {
                    $('#tr_extra_' + extraId).remove();
                }
            );
            get_regextralist();
        }

        function get_regextralist()
        {
            var reg_id = $('#Registration_ID').val();
            if (reg_id == '') {
                //alert('You must save the user before you can add extras');
                return;
            }

            $.getJSON('/registration/list/extra/' + reg_id,
                {},
                function (json)
                {
                    $('#extras').empty();

                    var extraCount = json.length;
                    for (var i = 0; i < extraCount; i++) {
                        var extraId = json[i]['extraId'];
                        var extra = json[i]['extra'];
                        render_extras(extraId, extra);
                    }
                }
            );
        }

        $('#staffmodify').click(function ()
        {
            action = 'remove';
            if ($('#staffmodify').html() == 'Add') {
                var action = 'add';
            }

            var reg_id = $('#Registration_ID').val();
            // Submit the AJAX
            $.ajax({
                type: 'POST',
                url: '/ajaxstaffmodify/' + reg_id + '/' + action,
                dataType: 'json',
                data: $('#form_editregistration').serialize(),
                error: function (x, textStatus)
                {
                    if (textStatus == 'parsererror') {
                        var error = 'Invalid JSON returned. Please retry.';
                    } else {
                        if (textStatus == 'timeout') {
                            var error = 'Timeout Error: Could not communicate with server. Check connection';
                        } else {
                            var error = textStatus + ': Please try again.';
                        }
                    }
                    $('#alert_div').show();
                    $('#alert_msg').text(error);
                    $('#alert_heading').text('Info');
                    $('#alert_subdiv').addClass('bs-callout-danger');
                    $('#alert_subdiv').removeClass('bs-callout-info');
                }
            })
                .done(function (data)
                {
                    $('#alert_div').show();
                    $('#alert_msg').text(data['message']);
                    if (data['success']) {
                        $('#alert_heading').text('Info');
                        $('#alert_subdiv').removeClass('bs-callout-danger');
                        $('#alert_subdiv').addClass('bs-callout-info');

                        jQuery.data(document.body, "is_staff", false);
                        if (action == 'add') {
                            jQuery.data(document.body, "is_staff", true);
                        }
                        staffdivstyle();
                    } else {
                        $('#alert_heading').text('Error');
                        $('#alert_subdiv').addClass('bs-callout-danger');
                        $('#alert_subdiv').removeClass('bs-callout-info');
                    }
                });
        });

        jQuery.data(document.body, "is_staff", {{ isStaff }});
        staffdivstyle();
        function staffdivstyle()
        {
            if (jQuery.data(document.body, "is_staff")) {
                $('#staffdiv').removeClass('alert-danger');
                $('#staffdiv').addClass('alert-info');
                $('#staffmsg').html('This member is also listed on staff for this year.');
                $('#staffmodify').html('Remove');
            } else {
                $('#staffdiv').removeClass('alert-info');
                $('#staffdiv').addClass('alert-danger');
                $('#staffmsg').html('This member is not listed as staff.');
                $('#staffmodify').html('Add');
            }
        }

        $('#save_form').click(function ()
        {
            // Submit the AJAX
            $.ajax({
                type: 'POST',
                url: '/registration/ajax/edit',
                dataType: 'json',
                data: $('#form_editregistration').serialize(),
                error: function (x, textStatus)
                {
                    if (textStatus == 'parsererror') {
                        var error = 'Invalid JSON returned. Please retry.';
                    } else {
                        if (textStatus == 'timeout') {
                            var error = 'Timeout Error: Could not communicate with server. Check connection';
                        } else {
                            var error = textStatus + ': Please try again.';
                        }
                    }
                    $('#alert_div').show();
                    $('#alert_msg').text(error);
                    $('#alert_heading').text('Info');
                    $('#alert_subdiv').addClass('bs-callout-danger');
                    $('#alert_subdiv').removeClass('bs-callout-info');
                }
            })
                .done(function (data)
                {
                    $('#alert_div').show();
                    $('#alert_msg').text(data['message']);
                    if (data['success']) {
                        $('#alert_heading').text('Info');
                        $('#alert_subdiv').removeClass('bs-callout-danger');
                        $('#alert_subdiv').addClass('bs-callout-info');
                        $('#Registration_ID').val(data['Registration_ID']);

                        var group = '';
                        if ($('#RegGroup_ID').val() != '') {
                            group = 'Group ';
                        }
                        $('#reg_header').html(
                            'Edit ' + group + 'Membership - ' + data['Year'] + ' - ' + data['Number']);
                        var reggroup_id = '{{ group.reggroupId|default('') }}';
                        if (reggroup_id != '') {
                            reggroup_id = '/' + reggroup_id;
                        }
                        window.history.pushState("object or string", "Registration " + data['Number'],
                            "/registration/edit/" + data['Registration_ID'] + reggroup_id);
                    } else {
                        $('#alert_heading').text('Error');
                        $('#alert_subdiv').addClass('bs-callout-danger');
                        $('#alert_subdiv').removeClass('bs-callout-info');
                    }
                });
        });

        $('#RegistrationType').on('change', function ()
        {
            if (this.value == 'Group') {
                $('#RegGroup_ID').show();
            } else {
                $('#RegGroup_ID').hide();
            }
        });

    </script>
    <style>
        .close-btn {
            border: 2px solid #c2c2c2;
            float: right;
            padding: 1px 5px;
            background-color: #605F61;
            border-radius: 20px;
        }

        .close-btn a {
            font-size: 15px;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }
    </style>
{% endblock %}
